# Sources:
# - Author: Nick Quaranto
# 	- http://quaran.to/blog/2013/01/09/use-jekyll-scss-coffeescript-without-plugins/
# - Octopress' rakefile
# 	- https://github.com/imathis/octopress/blob/master/Rakefile

server_port = "9000" # port for preview server eg. localhost:9000

task :default => [:serve]

desc "Build the scss"
task :build do
  puts "## Compiling styles with compass and minimizing"

  system "compass compile -e production --force" # Forcing compass to rewrite new css file
end

desc "Watch the scss and regenerate when it changes"
task :serve do
  puts "## Starting to watch scss with Compass and creating web server at port #{server_port}"

  system "compass compile --force" # Forcing compass to rewrite new css file
  serverPid = Process.spawn("serve -p #{server_port} --compress") # Local http server (npm package)
  compassPid = Process.spawn("compass watch") # Compass watches project folder

  trap("INT") {
    [serverPid, compassPid].each { |pid| Process.kill(9, pid) rescue Errno::ESRCH }
    exit 0
  }

  [serverPid, compassPid].each { |pid| Process.wait(pid) }
end

task :server do
	puts "## Dont use server, use serve instead"
end